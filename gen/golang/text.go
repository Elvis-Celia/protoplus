package golang

// 报错行号+7
const goCodeTemplate = `// Generated by github.com/davyxu/protoplus
// DO NOT EDIT!
package {{.PackageName}}

import (
	"github.com/davyxu/protoplus/proto"
	"fmt"
)
var (
	_ *proto.Buffer
	_ fmt.Stringer
)

{{range $a, $enumobj := .Enums}}
type {{.Name}} int32
const (	{{range .Fields}}
	{{$enumobj.Name}}_{{.Name}} {{.Type}} = {{TagNumber $enumobj .}} {{end}}
)

var (
{{$enumobj.Name}}MapperValueByName = map[string]int32{ {{range .Fields}}
	"{{.Name}}": {{TagNumber $enumobj .}}, {{end}}
}

{{$enumobj.Name}}MapperNameByValue = map[int32]string{ {{range .Fields}}
	{{TagNumber $enumobj .}}: "{{.Name}}" , {{end}}
}
)

func (self {{$enumobj.Name}}) String() string {
	return {{$enumobj.Name}}MapperNameByValue[int32(self)]
}
{{end}}

{{range $a, $obj := .Structs}}
{{ObjectLeadingComment .}}
type {{.Name}} struct{	{{range .Fields}}
	{{GoFieldName .}} {{ProtoTypeName .}} {{GoStructTag .}}{{FieldTrailingComment .}} {{end}}
}

func (self *{{.Name}}) String() string { return fmt.Sprintf("%+v",*self) }

func (self *{{.Name}}) Size() (ret int) {
{{range .Fields}}
	ret += proto.Size{{CodecName .}}({{TagNumber $obj .}}, self.{{GoFieldName .}})
{{end}}
	return
}

func (self *{{.Name}}) Marshal(buffer *proto.Buffer) error {
{{range .Fields}}
	if err := proto.Marshal{{CodecName .}}(buffer, {{TagNumber $obj .}}, self.{{GoFieldName .}}); err != nil {
		return err
	}
{{end}}
	return nil
}

func (self *{{.Name}}) Unmarshal(buffer *proto.Buffer, fieldIndex uint64, wt proto.WireType) error {
	switch fieldIndex {
	{{range .Fields}} case {{TagNumber $obj .}}:
		return proto.Unmarshal{{CodecName .}}(buffer, wt, &self.{{GoFieldName .}})
	{{end}}
	}

	return proto.ErrUnknownField
}
{{end}}

`
